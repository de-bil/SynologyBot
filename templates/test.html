{% extends "base.html" %}

{% block content %}
<div class="content">
    <h2>üß™ –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</h3>
            <div class="stat-number uptime-display">{{ uptime }}</div>
            <p>–° –º–æ–º–µ–Ω—Ç–∞ –∑–∞–ø—É—Å–∫–∞</p>
        </div>
    </div>
    
    {% if message %}
    <div class="content" style="background: {% if '‚úÖ' in message %}rgba(76, 175, 80, 0.2){% else %}rgba(244, 67, 54, 0.2){% endif %}; border-left: 4px solid {% if '‚úÖ' in message %}#4CAF50{% else %}#f44336{% endif %};">
        <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
        <p>{{ message }}</p>
    </div>
    {% endif %}
    
    <div class="test-form">
        <h3>üì® –¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
        <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞:</p>
        
        <form action="/send_test" method="POST" id="test-form">
            <div class="form-group">
                <label for="message">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                <textarea id="message" name="message" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">–ü—Ä–∏–≤–µ—Ç! –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</textarea>
            </div>
            <button type="submit" class="btn">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç</button>
        </form>
    </div>

    <div class="content">
        <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</h3>
        <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:</p>
        <ul>
            <li>‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Synology Chat</li>
            <li>‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å webhook URL</li>
            <li>‚úÖ –û–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–æ–º</li>
            <li>‚úÖ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤</li>
        </ul>
        
        <p><strong>Webhook URL:</strong> http://192.168.10.219:{{ port }}/webhook</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="connection-status">‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span></p>
    </div>
</div>

<script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
    function checkConnection() {
        fetch('/api/health')
            .then(response => {
                const statusElement = document.getElementById('connection-status');
                if (response.ok) {
                    statusElement.innerHTML = '‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                    statusElement.style.color = '#4CAF50';
                } else {
                    statusElement.innerHTML = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                    statusElement.style.color = '#f44336';
                }
            })
            .catch(error => {
                const statusElement = document.getElementById('connection-status');
                statusElement.innerHTML = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                statusElement.style.color = '#f44336';
            });
    }

    // AJAX –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('test-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const submitButton = this.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        
        submitButton.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
        submitButton.disabled = true;
        
        fetch('/send_test', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(html => {
            document.open();
            document.write(html);
            document.close();
        })
        .catch(error => {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ' + error);
            submitButton.textContent = originalText;
            submitButton.disabled = false;
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        checkConnection();
        setInterval(checkConnection, 10000);
    });
</script>

{% endblock %}
