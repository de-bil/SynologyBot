{% extends "base.html" %}

{% block content %}
<div class="content">
    <h2>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>üü¢ –°—Ç–∞—Ç—É—Å</h3>
            <div class="stat-number">–ê–∫—Ç–∏–≤–µ–Ω</div>
            <p>–°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ</p>
        </div>
        <div class="stat-card">
            <h3>ü§ñ –ë–æ—Ç</h3>
            <div class="stat-number">{{ bot_name }}</div>
            <p>–ò–º—è –±–æ—Ç–∞</p>
        </div>
        <div class="stat-card">
            <h3>‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</h3>
            <div class="stat-number uptime-display">{{ uptime }}</div>
            <p>–° –º–æ–º–µ–Ω—Ç–∞ –∑–∞–ø—É—Å–∫–∞</p>
        </div>
    </div>

    <div class="content">
        <h3>üåê Webhook –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <p><strong>URL:</strong> http://192.168.10.219:{{ port }}/webhook</p>
        <p><strong>–ú–µ—Ç–æ–¥:</strong> POST</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="webhook-status">‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span></p>
    </div>

    <div class="content">
        <h3>üìã –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <p><strong>–í–µ—Ä—Å–∏—è Python:</strong> 3.8+</p>
        <p><strong>–§—Ä–µ–π–º–≤–æ—Ä–∫:</strong> Flask</p>
        <p><strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> SQLite (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)</p>
        <p><strong>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –í–∫–ª—é—á–µ–Ω–æ (synology_bot.log)</p>
    </div>
</div>

<script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ webhook
    function checkWebhookStatus() {
        fetch('/health')
            .then(response => {
                const statusElement = document.getElementById('webhook-status');
                if (response.ok) {
                    statusElement.innerHTML = '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
                    statusElement.style.color = '#4CAF50';
                } else {
                    statusElement.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                    statusElement.style.color = '#f44336';
                }
            })
            .catch(error => {
                const statusElement = document.getElementById('webhook-status');
                statusElement.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                statusElement.style.color = '#f44336';
            });
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        checkWebhookStatus();
        setInterval(checkWebhookStatus, 30000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    });
</script>
{% endblock %}